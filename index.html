<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Regal CafÃ© â€“ Scan to Order</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Regal CafÃ© â˜•</h1>
    <div id="tableId">Table: â€”</div>
  </header>

  <main>
    <div class="menu-grid" id="menuGrid"></div>
  </main>

  <footer>
    <div id="orderSummary">No items added yet.</div>
    <button id="submitOrder">Submit Order via WhatsApp</button>
  </footer>

  <script>
    document.getElementById('submitOrder').addEventListener('click', () => {
      const lines = [];
      let total = 0;
      for (const [idx, qty] of Object.entries(cart)) {
        if (qty > 0) {
          const item = menuItems[idx];
          lines.push(`${qty} Ã— ${item.name} â€” â‚¹${item.price * qty}`);
          total += item.price * qty;
        }
      }
    
      if (!lines.length) return alert('Please add items to your order.');
    
      const now = new Date();
      const formattedTime = now.toLocaleString('en-IN', {
        hour: 'numeric',
        minute: '2-digit',
        hour12: true,
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });
    
      const summaryText =
        `ðŸ›Ž Order from Regal CafÃ©\n` +
        `ðŸ“ Table: ${tableNum}\n\n` +
        lines.join('\n') +
        `\n\nðŸ’° Total: â‚¹${total}` +
        `\nðŸ—“ï¸ Order placed on: ${formattedTime}`;
    
      // Create canvas image
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = '16px sans-serif';
      const lineHeight = 24;
      const padding = 20;
      const linesArr = summaryText.split('\n');
      canvas.width = 450;
      canvas.height = padding * 2 + linesArr.length * lineHeight;
    
      // Draw background
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    
      // Draw text
      ctx.fillStyle = '#000';
      linesArr.forEach((line, i) => {
        ctx.fillText(line, padding, padding + (i + 1) * lineHeight);
      });
    
      // Convert to image
      const imageDataUrl = canvas.toDataURL('image/png');
    
      // Upload prompt
      const imageWindow = window.open();
      imageWindow.document.write(`<p>ðŸ§¾ Screenshot or long-press to save, then send via WhatsApp manually:</p>`);
      imageWindow.document.write(`<img src="${imageDataUrl}" style="max-width:100%">`);
      imageWindow.document.write(`<p><a href="https://wa.me/919036120124?text=${encodeURIComponent('ðŸ§¾ Please find attached the order from Table ' + tableNum)}" target="_blank">Click to Open WhatsApp Chat</a></p>`);
    });
    </script>    
</body>
</html>
