<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Regal CafÃ© â€“ Scan to Order</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>Regal CafÃ© â˜•</h1>
    <div id="tableId">Table: â€”</div>
  </header>

  <main>
    <div class="menu-grid" id="menuGrid"></div>
  </main>

  <footer>
    <div id="orderSummary">No items added yet.</div>
    <button id="submitOrder">Submit Order via WhatsApp</button>
  </footer>

  <script>
    const menuItems = [
      { name: "Cold Coffee", price: 80, img: "https://source.unsplash.com/featured/?cold-coffee" },
      { name: "Hot Coffee", price: 60, img: "https://source.unsplash.com/featured/?hot-coffee" },
      { name: "Lassi", price: 50, img: "https://source.unsplash.com/featured/?lassi" },
      { name: "Mojito", price: 70, img: "https://source.unsplash.com/featured/?mojito" },
      { name: "French Fries", price: 90, img: "https://source.unsplash.com/featured/?fries" },
      { name: "Veg Sandwich", price: 85, img: "https://source.unsplash.com/featured/?sandwich" },
      { name: "Cheese Sandwich", price: 110, img: "https://source.unsplash.com/featured/?cheese-sandwich" },
      { name: "Maggie", price: 60, img: "https://source.unsplash.com/featured/?maggie" },
      { name: "Egg Maggie", price: 80, img: "https://source.unsplash.com/featured/?egg-noodles" },
      { name: "Oreo Shake", price: 100, img: "https://source.unsplash.com/featured/?oreo-shake" }
    ];

    const cart = {};
    const menuGrid = document.getElementById('menuGrid');

    function updateCartDisplay() {
      const summary = Object.entries(cart).map(([idx, qty]) => {
        const item = menuItems[idx];
        return qty > 0 ? `${qty} Ã— ${item.name}` : null;
      }).filter(Boolean).join(', ');
      document.getElementById('orderSummary').textContent = summary || 'No items added yet.';
    }

    menuItems.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'menu-item';
      div.innerHTML = `
        <img src="${item.img}" alt="${item.name}" />
        <h3>${item.name}</h3>
        <p>â‚¹${item.price}</p>
        <div class="qty-controls">
          <button onclick="updateQty(${index}, -1)">âˆ’</button>
          <span id="qty-${index}">0</span>
          <button onclick="updateQty(${index}, 1)">+</button>
        </div>
      `;
      menuGrid.appendChild(div);
      cart[index] = 0;
    });

    function updateQty(index, change) {
      cart[index] = Math.max(0, cart[index] + change);
      document.getElementById(`qty-${index}`).textContent = cart[index];
      updateCartDisplay();
    }

    // Table number from URL
    const tableParams = new URLSearchParams(window.location.search);
    const tableNum = tableParams.get('table') || 'â€”';
    document.getElementById('tableId').textContent = 'Table: ' + tableNum;

    document.getElementById('submitOrder').addEventListener('click', () => {
      const lines = [];
      let total = 0;
      for (const [idx, qty] of Object.entries(cart)) {
        if (qty > 0) {
          const item = menuItems[idx];
          lines.push(`${qty} Ã— ${item.name} â€” â‚¹${item.price * qty}`);
          total += item.price * qty;
        }
      }

      if (!lines.length) return alert('Please add items to your order.');

      const now = new Date();
      const formattedTime = now.toLocaleString('en-IN', {
        hour: 'numeric',
        minute: '2-digit',
        hour12: true,
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });

      const summaryText =
        `ðŸ›Ž Order from Regal CafÃ©\n` +
        `ðŸ“ Table: ${tableNum}\n\n` +
        lines.join('\n') +
        `\n\nðŸ’° Total: â‚¹${total}` +
        `\nðŸ—“ï¸ Order placed on: ${formattedTime}`;

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = '16px sans-serif';
      const lineHeight = 24;
      const padding = 20;
      const linesArr = summaryText.split('\n');
      canvas.width = 450;
      canvas.height = padding * 2 + linesArr.length * lineHeight;
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#000';
      linesArr.forEach((line, i) => {
        ctx.fillText(line, padding, padding + (i + 1) * lineHeight);
      });

      const imageDataUrl = canvas.toDataURL('image/png');
      const imageWindow = window.open();
      imageWindow.document.write(`<p>ðŸ§¾ Screenshot or long-press to save, then send via WhatsApp manually:</p>`);
      imageWindow.document.write(`<img src="${imageDataUrl}" style="max-width:100%">`);
      imageWindow.document.write(`<p><a href="https://wa.me/919036120124?text=${encodeURIComponent('ðŸ§¾ Please find attached the order from Table ' + tableNum)}" target="_blank">Click to Open WhatsApp Chat</a></p>`);
    });
  </script>
</body>
</html>
