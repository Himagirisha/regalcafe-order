<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Regal CafÃ© â€“ Scan to Order</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>Regal CafÃ© â˜•</h1>
    <div id="tableId">Table: â€”</div>
  </header>

  <section class="category-buttons" id="categoryFilters">
    <button data-category="All">All</button>
    <button data-category="Appetizers">Appetizers</button>
    <button data-category="Pizzeria">Pizzeria</button>
    <button data-category="Cold Brews">Cold Brews</button>
    <button data-category="Beverages">Beverages</button>
    <button data-category="Main Course">Main Course</button>
    <button data-category="Desserts">Desserts</button>
  </section>

  <main>
    <div class="menu-grid" id="menuGrid"></div>
  </main>

  <footer>
    <div id="orderSummary">No items added yet.</div>
    <button id="submitOrder">Submit Order via WhatsApp</button>
  </footer>

  <script>
    const menuItems = [
      { name: "Cold Coffee", price: 80, img: "images/cold-coffee.jpg", category: "Cold Brews" },
      { name: "Filter Coffee", price: 60, img: "images/filter-coffee.jpg", category: "Beverages" },
      { name: "Mango Lassi", price: 50, img: "images/mango-lassi.jpg", category: "Beverages" },
      { name: "Mojito", price: 70, img: "images/mojito.jpg", category: "Beverages" },
      { name: "French Fries", price: 90, img: "images/french-fries.jpg", category: "Appetizers" },
      { name: "Cheese Sandwich", price: 110, img: "images/cheese-sandwich.jpg", category: "Appetizers" },
      { name: "Paneer Wrap", price: 110, img: "images/wrap.jpg", category: "Appetizers" },
      { name: "Maggie", price: 60, img: "images/maggi.jpg", category: "Main Course" },
      { name: "Oreo Shake", price: 100, img: "images/oreo-shake.jpg", category: "Desserts" }

    ];

    const cart = {};
    const tableNum = "â€”"; // Replace this with actual dynamic table ID logic if needed

    function updateQty(idx, delta) {
      cart[idx] = (cart[idx] || 0) + delta;
      if (cart[idx] < 0) cart[idx] = 0;
      document.getElementById(`qty-${idx}`).innerText = cart[idx];
      updateOrderSummary();
    }

    function updateOrderSummary() {
      let summary = '';
      let total = 0;
      for (const [idx, qty] of Object.entries(cart)) {
        if (qty > 0) {
          const item = menuItems[idx];
          summary += `${qty} Ã— ${item.name} = â‚¹${item.price * qty}\n`;
          total += item.price * qty;
        }
      }
      document.getElementById('orderSummary').innerText = summary || 'No items added yet.';
    }

    function renderMenu(category = "All") {
      const grid = document.getElementById("menuGrid");
      grid.innerHTML = "";
      const filtered = category === "All"
        ? menuItems
        : menuItems.filter(item => item.category === category);

      filtered.forEach((item, idx) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <h3>${item.name}</h3>
          <p>â‚¹${item.price}</p>
          <div class="qty-controls">
            <button onclick="updateQty(${idx}, -1)">â€“</button>
            <span id="qty-${idx}">${cart[idx] || 0}</span>
            <button onclick="updateQty(${idx}, 1)">+</button>
          </div>
        `;
        grid.appendChild(div);
      });
    }

    // Category filter listeners
    document.querySelectorAll("#categoryFilters button").forEach(btn => {
      btn.addEventListener("click", () => {
        renderMenu(btn.dataset.category);
      });
    });

    // Order submit handler
    document.getElementById('submitOrder').addEventListener('click', () => {
      const lines = [];
      let total = 0;
      for (const [idx, qty] of Object.entries(cart)) {
        if (qty > 0) {
          const item = menuItems[idx];
          lines.push(`${qty} Ã— ${item.name} â€” â‚¹${item.price * qty}`);
          total += item.price * qty;
        }
      }

      if (!lines.length) return alert('Please add items to your order.');

      const now = new Date();
      const formattedTime = now.toLocaleString('en-IN', {
        hour: 'numeric',
        minute: '2-digit',
        hour12: true,
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });

      const summaryText =
        `ðŸ›Ž Order from Regal CafÃ©\n` +
        `ðŸ“ Table: ${tableNum}\n\n` +
        lines.join('\n') +
        `\n\nðŸ’° Total: â‚¹${total}` +
        `\nðŸ—“ï¸ Order placed on: ${formattedTime}`;

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = '16px sans-serif';
      const lineHeight = 24;
      const padding = 20;
      const linesArr = summaryText.split('\\n');
      canvas.width = 450;
      canvas.height = padding * 2 + linesArr.length * lineHeight;

      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#000';
      linesArr.forEach((line, i) => {
        ctx.fillText(line, padding, padding + (i + 1) * lineHeight);
      });

      const imageDataUrl = canvas.toDataURL('image/png');
      const imageWindow = window.open();
      imageWindow.document.write(`<p>ðŸ§¾ Screenshot or long-press to save, then send via WhatsApp manually:</p>`);
      imageWindow.document.write(`<img src=\"${imageDataUrl}\" style=\"max-width:100%\">`);
      imageWindow.document.write(`<p><a href=\"https://wa.me/919036120124?text=${encodeURIComponent('ðŸ§¾ Please find attached the order from Table ' + tableNum)}\" target=\"_blank\">Click to Open WhatsApp Chat</a></p>`);
    });

    // Initial menu render
    renderMenu();
  </script>
</body>
</html>
